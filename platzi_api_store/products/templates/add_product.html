{% extends 'base.html' %}

{% block title %}Crear producto{% endblock %}

{% block content %}
    <h2>Agregar Producto</h2>
    <form id="productForm" class="card">
        <div class="form-group">
            <label for="title">Título:</label>
            <input type="text" id="title" name="title" required>
        </div>
        <div class="form-group">
            <label for="price">Precio:</label>
            <input type="number" id="price" name="price" required>
        </div>
        <div class="form-group">
            <label for="description">Descripción:</label>
            <textarea id="description" name="description" required></textarea>
        </div>
        <div class="form-group">
            <label for="category">ID Categoría:</label>
            <input type="number" id="category" name="category" value="1" required>
        </div>
        <div class="form-group">
            <label for="image">URL Imagen:</label>
            <input type="text" id="image" name="image" value="https://placeimg.com/640/480/any" required>
        </div>
        <button type="submit" class="btn btn-primary">Agregar Producto</button>
    </form>
    
    <div id="result"></div>
    
    <script>
        function addProduct() {
            const product = {
                title: document.getElementById("title").value,
                price: document.getElementById("price").value,
                description: document.getElementById("description").value,
                categoryId: document.getElementById("category").value,
                image: document.getElementById("image").value
            };
            
            fetch("/add_product/", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify(product)
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert("Producto agregado con éxito: " + data.product.title);
                    window.location.href = `/product/${data.product.id}/`; // Redirigir a la página de detalles del nuevo producto
                } else {
                    alert("Error: " + data.error);
                }
            })
            .catch(err => alert("Error al enviar producto: " + err.message));
        }
        document.getElementById("productForm").addEventListener("submit", function(e) {
            e.preventDefault();
            addProduct();
        });

    </script>
{% endblock %}